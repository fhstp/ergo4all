name: Test

on:
  - push

jobs:
  changes:
    name: Check for relevant changes
    runs-on: ubuntu-latest
    outputs:
      unit: ${{ steps.filter.outputs.changes }}

    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v4

      - name: Check changes ğŸŸ¥ğŸŸ©
        uses: dorny/paths-filter@v3
        id: filter
        with:
          filters: |
            changes:
              - 'lib/**'
              - 'packages/**'
              - 'test/**'
              - 'assets/**'
              - 'pub*'

  unit-test:
    name: Unit Test
    needs: changes
    if: ${{ needs.changes.outputs.unit == 'true'}}
    runs-on: ubuntu-latest

    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v4

      - name: Setup Flutter ğŸ¦
        uses: kuhnroyal/flutter-fvm-config-action@v2
        with: 
          setup: true
          cache: true

      - name: Setup Very Good CLI ğŸ¦„
        run: dart pub global activate very_good_cli

      - name: Get dependencies ğŸ“¦
        run: very_good packages get -r

      - name: Generate Localizations ğŸ—£ï¸
        run: fvm flutter gen-l10n

      - name: Run tests ğŸ§ª
        run: very_good test -r